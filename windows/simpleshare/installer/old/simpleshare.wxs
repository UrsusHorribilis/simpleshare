<?xml version='1.0' encoding='windows-1252'?>
<Wix xmlns='http://schemas.microsoft.com/wix/2006/wi'>

<Product Name='Box SimpleShare' Id='{51632F0A-BAC6-41d1-AC1A-77EA1FE63803}' UpgradeCode='CD328FD5-F906-48A8-9DE8-35930E31B248' Version='1.0.11'
    Language='1033' Codepage='1252' Manufacturer='Box.net'>

    <Package Id='*' Keywords='Installer' Description="Box SimpleShare Installer" 
      Comments='SimpleShare is a registered trademark of Box.net Inc.' Manufacturer='Box.net'
      InstallerVersion='100' Languages='1033' Compressed='yes' SummaryCodepage='1252' />

    <Upgrade Id='CD328FD5-F906-48A8-9DE8-35930E31B248'>
        <UpgradeVersion OnlyDetect='no'  Maximum="1.0.11" IncludeMaximum='no' Property='OLDPRODUCTS' MigrateFeatures="yes" ExcludeLanguages="yes" />
        <UpgradeVersion OnlyDetect='yes' Minimum='1.0.11' IncludeMinimum='no' Property='NEWERFOUND' />
	</Upgrade>

	<CustomAction Id='NoDowngrade' Error='A later version of [ProductName] is already installed.' />

    <Media Id='1' Cabinet='simpleshare.cab' EmbedCab='yes'  />

    <Directory Id='TARGETDIR' Name='SourceDir'>

        <Directory Id='ProgramFilesFolder' Name='PFiles'>
            <Directory Id='INSTALLDIR' Name='Box SimpleShare'>

                <Component Id='MainExecutable' Guid='72A79CA2-5F18-4d98-8775-E72329429658'>
                    <File Id='SimpleShareEXE' Name='SimpleShare.exe' DiskId='1' Source='SimpleShare.exe' KeyPath='yes'>
                        <Shortcut Id="startmenuSimpleShare" Directory="ProgramMenuDir" Name="SimpleShare"
                            WorkingDirectory='INSTALLDIR' Icon="SimpleShare.exe" IconIndex="0" Advertise="yes" />
                        <Shortcut Id="desktopSimpleShare" Directory="DesktopFolder" Name="SimpleShare"
                            WorkingDirectory='INSTALLDIR' Icon="SimpleShare.exe" IconIndex="0" Advertise="yes" />
                    </File>

                    <File Id='mingw10DLL' Name='mingwm10.dll' DiskId='1' Source='mingwm10.dll' />
                    <File Id='libgccDLL' Name='libgcc_s_dw2-1.dll' DiskId='1' Source='libgcc_s_dw2-1.dll' />

                    <File Id='QtCore4DLL' Name='QtCore4.dll' DiskId='1' Source='QtCore4.dll' />
                    <File Id='QtGui4DLL' Name='QtGui4.dll' DiskId='1' Source='QtGui4.dll' />
                    <File Id='QtNetwork4DLL' Name='QtNetwork4.dll' DiskId='1' Source='QtNetwork4.dll' />
                    <File Id='QtXml4DLL' Name='QtXml4.dll' DiskId='1' Source='QtXml4.dll' />

                    <File Id='ssleay32DLL' Name='ssleay32.dll' DiskId='1' Source='ssleay32.dll' />
                    <File Id='libeay32DLL' Name='libeay32.dll' DiskId='1' Source='libeay32.dll' />
                    <File Id='libssl32DLL' Name='libssl32.dll' DiskId='1' Source='libssl32.dll' />

                    <File Id='avcodec_52DLL' Name='avcodec-52.dll' DiskId='1' Source='avcodec-52.dll' />
                    <File Id='avformat_52DLL' Name='avformat-52.dll' DiskId='1' Source='avformat-52.dll' />
                    <File Id='avutil_50DLL' Name='avutil-50.dll' DiskId='1' Source='avutil-50.dll' />
                    <File Id='swscale_0DLL' Name='swscale-0.dll' DiskId='1' Source='swscale-0.dll' />
                  
                    <RegistryValue Root='HKCR' Key='*\shellex\ContextMenuHandlers\SimpleShareExt' Type='string' Value='{50C646F0-78E5-44A1-A4FF-A4FE85362644}' />
                    <RegistryValue Root='HKCR' Key='Directory\shellex\ContextMenuHandlers\SimpleShareExt' Type='string' Value='{50C646F0-78E5-44A1-A4FF-A4FE85362644}' />

                    <File Id="menuhandler.dll" Name="menuhandler.dll" Vital="no" SelfRegCost="1" Source='menuhandler.dll' />

                </Component>

            </Directory>
        </Directory>

        <Directory Id="ProgramMenuFolder" Name="Programs">
            <Directory Id="ProgramMenuDir" Name="SimpleShare">
                <Component Id="ProgramMenuDir" Guid="F81ED2DB-F3DA-4f83-96DE-835D3DE08601">
                    <RemoveFolder Id='ProgramMenuDir' On='uninstall' />
                    <RegistryValue Root='HKCU' Key='Software\[Manufacturer]\[ProductName]' Type='string' Value='' KeyPath='yes' />
                    <RegistryValue Root='HKCU' Key='Software\Microsoft\Windows\CurrentVersion\Run' Type='string' Name='SimpleShare' Value='&quot;[INSTALLDIR]SimpleShare.exe&quot;' />
                </Component>
            </Directory>
        </Directory>

        <Directory Id="DesktopFolder" Name="Desktop" />
    </Directory>

    <Icon Id="SimpleShare.exe" SourceFile="SimpleShare.exe" />

    <Feature Id='Complete' Title='Foobar 1.0' Description='The complete package.'
		Display='expand' Level='1' ConfigurableDirectory='INSTALLDIR'>
		<Feature Id='MainProgram' Title='Program' Description='The main executable.' Level='1'>
        		<ComponentRef Id='MainExecutable' />
        		<ComponentRef Id='ProgramMenuDir' />
		</Feature>
	</Feature>

    <CustomAction Id='LaunchFile' FileKey='SimpleShareEXE' ExeCommand='' Return='asyncNoWait' />
    <InstallExecuteSequence>
        <RemoveExistingProducts Before="InstallInitialize" /> 
		<Custom Action='NoDowngrade' After='FindRelatedProducts'>NEWERFOUND</Custom>
        <Custom Action='LaunchFile' After='InstallFinalize' />
    </InstallExecuteSequence>

    <WixVariable Id="WixUIBannerBmp" Value="banner_image.jpg" />
    <WixVariable Id="WixUIDialogBmp" Value="dialog_image.jpg" />

    <UIRef Id="WixUI_InstallDirNoLicence" />
	<UIRef Id="WixUI_ErrorProgressText" />

	<Property Id="WIXUI_INSTALLDIR" Value="INSTALLDIR" />

</Product>

</Wix>
